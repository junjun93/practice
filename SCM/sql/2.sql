USE [DSSCM]
GO
/****** Object:  StoredProcedure [dbo].[MonthsPlanDetail]    Script Date: 2018/9/12 9:10:26 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- =============================================
-- Author:		fangjunjun
-- Create date: 20180808
-- Description:	集团化月计划预估明细表（采购员）
-- =============================================
ALTER PROCEDURE [dbo].[MonthsPlanDetail]

  @LoginID VARCHAR(20),
  @iSupplier VARCHAR(20)
AS
BEGIN

IF @iSupplier IS  NULL OR @iSupplier=''
BEGIN

  SELECT LEFT(TA010,6) AS TA010,TA032,MA002,TA006,MB002,MB003,TA007,TA015,TA017,TA001+'-'+TA002 AS DOCNO,
	CAST(TA015-TA017 AS INT) AS SCMQUANTITY
	FROM DS2010..MOCTA AS MOCTA
		INNER JOIN DS2010..INVMB ON MB001 = TA006
		 LEFT JOIN DS2010..PURMA ON MA001 = TA032

	UNION

	SELECT LEFT(TA010,6) AS TA010,TA032,MA002,TA006,MB002,MB003,TA007,TA015,TA017,TA001+'-'+TA002 AS DOCNO,
	CAST(TA015-TA017 AS INT) AS SCMQUANTITY
	FROM DS2018..MOCTA AS MOCTA
		INNER JOIN DS2018..INVMB ON MB001 = TA006
		 LEFT JOIN DS2018..PURMA ON MA001 = TA032

	UNION

	SELECT LEFT(TA010,6) AS TA010,TA032,MA002,TA006,MB002,MB003,TA007,TA015,TA017,TA001+'-'+TA002 AS DOCNO,
	CAST(TA015-TA017 AS INT) AS SCMQUANTITY
	FROM DS201803..MOCTA AS MOCTA
		INNER JOIN DS201803..INVMB ON MB001 = TA006
		 LEFT JOIN DS201803..PURMA ON MA001 = TA032

	UNION

	SELECT LEFT(TA010,6) AS TA010,TA032,MA002,TA006,MB002,MB003,TA007,TA015,TA017,TA001+'-'+TA002 AS DOCNO,
	CAST(TA015-TA017 AS INT) AS SCMQUANTITY
	FROM DS201805..MOCTA AS MOCTA
		INNER JOIN DS201805..INVMB ON MB001 = TA006
		 LEFT JOIN DS201805..PURMA ON MA001 = TA032

	UNION

	SELECT LEFT(TA010,6) AS TA010,TA032,MA002,TA006,MB002,MB003,TA007,TA015,TA017,TA001+'-'+TA002 AS DOCNO,
	CAST(TA015-TA017 AS INT) AS SCMQUANTITY
	FROM DS201808..MOCTA AS MOCTA
		INNER JOIN DS201808..INVMB ON MB001 = TA006
		 LEFT JOIN DS201808..PURMA ON MA001 = TA032

	UNION

	SELECT LEFT(TA010,6) AS TA010,TA032,MA002,TA006,MB002,MB003,TA007,TA015,TA017,TA001+'-'+TA002 AS DOCNO,
	CAST(TA015-TA017 AS INT) AS SCMQUANTITY
	FROM DS201810..MOCTA AS MOCTA
		INNER JOIN DS201810..INVMB ON MB001 = TA006
		 LEFT JOIN DS201810..PURMA ON MA001 = TA032
  --WHERE TC011=@LoginID AND TC014='Y' AND TD016='N'
END

ELSE
BEGIN
	SELECT LEFT(TA010,6) AS TA010,TA032,MA002,TA006,MB002,MB003,TA007,TA015,TA017,TA001+'-'+TA002 AS DOCNO,
	CAST(TA015-TA017 AS INT) AS SCMQUANTITY
	FROM DS2010..MOCTA AS MOCTA
		INNER JOIN DS2010..INVMB ON MB001 = TA006
		 LEFT JOIN DS2010..PURMA ON MA001 = TA032

	UNION

	SELECT LEFT(TA010,6) AS TA010,TA032,MA002,TA006,MB002,MB003,TA007,TA015,TA017,TA001+'-'+TA002 AS DOCNO,
	CAST(TA015-TA017 AS INT) AS SCMQUANTITY
	FROM DS2018..MOCTA AS MOCTA
		INNER JOIN DS2018..INVMB ON MB001 = TA006
		 LEFT JOIN DS2018..PURMA ON MA001 = TA032

	UNION

	SELECT LEFT(TA010,6) AS TA010,TA032,MA002,TA006,MB002,MB003,TA007,TA015,TA017,TA001+'-'+TA002 AS DOCNO,
	CAST(TA015-TA017 AS INT) AS SCMQUANTITY
	FROM DS201803..MOCTA AS MOCTA
		INNER JOIN DS201803..INVMB ON MB001 = TA006
		 LEFT JOIN DS201803..PURMA ON MA001 = TA032

	UNION

	SELECT LEFT(TA010,6) AS TA010,TA032,MA002,TA006,MB002,MB003,TA007,TA015,TA017,TA001+'-'+TA002 AS DOCNO,
	CAST(TA015-TA017 AS INT) AS SCMQUANTITY
	FROM DS201805..MOCTA AS MOCTA
		INNER JOIN DS201805..INVMB ON MB001 = TA006
		 LEFT JOIN DS201805..PURMA ON MA001 = TA032

	UNION

	SELECT LEFT(TA010,6) AS TA010,TA032,MA002,TA006,MB002,MB003,TA007,TA015,TA017,TA001+'-'+TA002 AS DOCNO,
	CAST(TA015-TA017 AS INT) AS SCMQUANTITY
	FROM DS201808..MOCTA AS MOCTA
		INNER JOIN DS201808..INVMB ON MB001 = TA006
		 LEFT JOIN DS201808..PURMA ON MA001 = TA032

	UNION

	SELECT LEFT(TA010,6) AS TA010,TA032,MA002,TA006,MB002,MB003,TA007,TA015,TA017,TA001+'-'+TA002 AS DOCNO,
	CAST(TA015-TA017 AS INT) AS SCMQUANTITY
	FROM DS201810..MOCTA AS MOCTA
		INNER JOIN DS201810..INVMB ON MB001 = TA006
		 LEFT JOIN DS201810..PURMA ON MA001 = TA032
  --WHERE TC011=@LoginID AND TC014='Y' AND TD016='N' AND TC004=@iSupplier

END

END

